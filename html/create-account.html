<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account - Kids Medical Center</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <!-- Add Bootstrap and Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .character-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
        }

        .circle-icon {
            width: 80px;
            height: 80px;
            background: #fff5e6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .circle-icon:hover {
            transform: scale(1.1);
            background: #ffe0cc;
        }

        .circle-icon i {
            font-size: 2.5rem;
            color: #ff4500;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <a href="index.html" class="home-button">üè† Home</a>
        <div class="login-card">
            <div class="login-header">
                <h1>Create Account üé®</h1>
                <div class="character-container">
                    <div class="circle-icon">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="circle-icon">
                        <i class="fas fa-hospital"></i>
                    </div>
                    <div class="circle-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                </div>
            </div>
            <form class="login-form" id="createAccountForm" novalidate>
                <div class="form-group">
                    <label for="fullName">üë§ Full Name <span class="required">*</span></label>
                    <input type="text" id="fullName" class="form-control" required minlength="3">
                    <div class="invalid-feedback">Please enter your full name (minimum 3 characters)</div>
                </div>
                
                <div class="form-group">
                    <label for="email">üìß Email Address <span class="required">*</span></label>
                    <input type="email" id="email" class="form-control" required>
                    <div class="invalid-feedback">Please enter a valid email address</div>
                </div>

                <div class="form-group">
                    <label for="phone">üìû Phone Number <span class="required">*</span></label>
                    <input type="tel" id="phone" class="form-control" required pattern="[0-9]{10}">
                    <div class="invalid-feedback">Please enter a valid 10-digit phone number</div>
                </div>

                <div class="form-group">
                    <label for="password">üîí Password <span class="required">*</span></label>
                    <div class="password-input-group">
                        <input type="password" id="password" class="form-control" required>
                        <button type="button" class="password-toggle" tabindex="-1">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-requirements">
                        Password must contain:
                        <ul>
                            <li id="length">At least 8 characters</li>
                            <li id="uppercase">One uppercase letter</li>
                            <li id="lowercase">One lowercase letter</li>
                            <li id="number">One number</li>
                            <li id="special">One special character</li>
                        </ul>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">üîí Confirm Password <span class="required">*</span></label>
                    <div class="password-input-group">
                        <input type="password" id="confirmPassword" class="form-control" required>
                        <button type="button" class="password-toggle" tabindex="-1">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="invalid-feedback">Passwords do not match</div>
                </div>

                <div class="role-selection">
                    <div class="role-option">
                        <input type="radio" id="parent" name="role" value="parent">
                        <label for="parent">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent/Guardian</label>
                    </div>
                    <div class="role-option">
                        <input type="radio" id="clinic" name="role" value="clinic">
                        <label for="clinic">üè• Clinic Staff</label>
                    </div>
                </div>

                <button type="submit" class="login-button" id="createAccountButton">
                    <span class="button-text">‚ú® Create Account</span>
                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                </button>
            </form>
            <div class="login-footer">
                <a href="login.html">üîô Back to Login</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/script.js"></script>
    <script type="module">
    import { db } from "../js/firebaseConfig.js";  // Import Firebase config
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const allFunction =()=>{
            
   
const form = document.getElementById('createAccountForm');
const password = document.getElementById('password');
const confirmPassword = document.getElementById('confirmPassword');

// Real-time password validation
password.addEventListener('input', function () {
    const value = this.value;
    document.getElementById('length').classList.toggle('valid', value.length >= 8);
    document.getElementById('uppercase').classList.toggle('valid', /[A-Z]/.test(value));
    document.getElementById('lowercase').classList.toggle('valid', /[a-z]/.test(value));
    document.getElementById('number').classList.toggle('valid', /\d/.test(value));
    document.getElementById('special').classList.toggle('valid', /[@$!%*?&]/.test(value));
});

function validateFullName() {
    const fullName = document.getElementById('fullName');
    if (fullName.value.length < 3) {
        fullName.classList.add('is-invalid');
        return false;
    }
    fullName.classList.remove('is-invalid');
    fullName.classList.add('is-valid');
    return true;
}

function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function validatePhone(phone) {
    const phoneRegex = /^\d{10}$/;
    return phoneRegex.test(phone);
}

function validatePassword(password) {
    return (
        password.length >= 8 &&
        /[A-Z]/.test(password) &&
        /[a-z]/.test(password) &&
        /\d/.test(password) &&
        /[@$!%*?&]/.test(password)
    );
}

function validateForm() {
    let isValid = true;
    const email = document.getElementById('email');
    const phone = document.getElementById('phone');
    const role = document.querySelector('input[name="role"]:checked');

    if (!validateFullName()) isValid = false;
    if (!validateEmail(email.value)) {
        email.classList.add('is-invalid');
        isValid = false;
    } else {
        email.classList.remove('is-invalid');
        email.classList.add('is-valid');
    }

    if (!validatePhone(phone.value)) {
        phone.classList.add('is-invalid');
        isValid = false;
    } else {
        phone.classList.remove('is-invalid');
        phone.classList.add('is-valid');
    }

    if (!validatePassword(password.value)) {
        password.classList.add('is-invalid');
        isValid = false;
    } else {
        password.classList.remove('is-invalid');
        password.classList.add('is-valid');
    }

    if (password.value !== confirmPassword.value) {
        confirmPassword.classList.add('is-invalid');
        isValid = false;
    } else {
        confirmPassword.classList.remove('is-invalid');
        confirmPassword.classList.add('is-valid');
    }

    if (!role) {
        document.querySelector('.role-selection').classList.add('is-invalid');
        isValid = false;
    } else {
        document.querySelector('.role-selection').classList.remove('is-invalid');
    }

    return isValid;
}

// Function to add user to Firestore
async function addUser(formData) {
    try {
        const docRef = await addDoc(collection(db, "users"), {
            name: formData.fullName,
            email: formData.email,
            phone: formData.phone,
            role: formData.role,
            createdAt: new Date().toISOString()
        });

        alert("User added with ID: " + docRef.id);
        window.location.href = "login.html";
    } catch (error) {
        console.error("Error adding document: ", error);
        showNotification("An error occurred while creating the account", "error");
    }
}

// Form submission
form.addEventListener('submit', async function (e) {
    e.preventDefault();

    if (!validateForm()) {
        showNotification('Please fill all required fields correctly', 'error');
        return;
    }

    const button = document.getElementById('createAccountButton');
    button.disabled = true;
    button.querySelector('.button-text').textContent = 'Creating Account...';
    button.querySelector('.spinner-border').classList.remove('d-none');

    const formData = {
        fullName: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        password: document.getElementById('password').value,
        role: document.querySelector('input[name="role"]:checked').value,
        createdAt: new Date().toISOString()
    };

    console.log("Form Data:", formData);

    try {
        await addUser(formData);

        const toastElement = document.createElement('div');
        toastElement.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        toastElement.innerHTML = `
            <div class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-check-circle me-2"></i>
                        Account created successfully! Redirecting to login...
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            </div>
        `;
        document.body.appendChild(toastElement);
        const toast = new bootstrap.Toast(toastElement.querySelector('.toast'));
        toast.show();

        form.reset();
    } catch (error) {
        console.error("Error:", error);
        showNotification("Account creation failed", "error");
    } finally {
        button.disabled = false;
        button.querySelector('.button-text').textContent = '‚ú® Create Account';
        button.querySelector('.spinner-border').classList.add('d-none');
    }
});

// Toggle password visibility
document.querySelectorAll('.password-toggle').forEach(button => {
    button.addEventListener('click', function () {
        const input = this.previousElementSibling;
        const icon = this.querySelector('i');

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
    });
});

// Show notifications
function showNotification(message, type) {
    const toastElement = document.createElement('div');
    toastElement.className = `alert alert-${type === "error" ? "danger" : "success"} alert-dismissible fade show`;
    toastElement.role = "alert";
    toastElement.innerHTML = `${message} <button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;

    document.body.appendChild(toastElement);
    setTimeout(() => {
        toastElement.remove();
    }, 5000);
}
        }
    
         allFunction()

    </script>
   
</body>
</html> 